<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>èªçŸ¥ç—‡ BPSD ã‚±ã‚¢ç®¡ç†ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&display=swap');
        body { font-family: 'Noto Sans JP', sans-serif; background-color: #f1f5f9; }
        .card { background: white; border-radius: 1rem; box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1); }
    </style>
</head>
<body class="p-4 md:p-8">
    <div class="max-w-6xl mx-auto bg-white shadow-2xl rounded-2xl overflow-hidden">
        
        <!-- Header -->
        <header class="bg-indigo-900 text-white p-8 text-center">
            <h1 class="text-3xl font-bold italic">èªçŸ¥ç—‡ BPSD ã‚±ã‚¢ç®¡ç†ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³</h1>
            <p class="mt-2 text-indigo-200">NPI-Qã«åŸºã¥ãè¡Œå‹•ãƒ»å¿ƒç†ç—‡çŠ¶è©•ä¾¡ãŠã‚ˆã³å€‹åˆ¥æœ€é©åŒ–ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®æä¾›</p>
        </header>

        <main class="p-8">
            <!-- Section 1: åŸºæœ¬æƒ…å ± -->
            <section class="mb-10 border-b pb-8">
                <h2 class="text-xl font-bold mb-6 flex items-center"><span class="bg-indigo-600 text-white rounded-full w-8 h-8 flex items-center justify-center mr-2 text-sm">1</span> åŸºæœ¬æƒ…å ±ã®å…¥åŠ›</h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div>
                        <label class="block text-sm font-semibold mb-1">åˆ©ç”¨è€…æ§˜ ãŠåå‰</label>
                        <input type="text" id="p_name" class="w-full border rounded p-2 focus:ring-2 focus:ring-indigo-500 outline-none" placeholder="ä¾‹ï¼šç”°ä¸­ èŠ±å­">
                    </div>
                    <div>
                        <label class="block text-sm font-semibold mb-1">ç”Ÿå¹´æœˆæ—¥</label>
                        <input type="text" id="p_birth" class="w-full border rounded p-2 focus:ring-2 focus:ring-indigo-500 outline-none" placeholder="YYYYMMDD">
                    </div>
                    <div>
                        <label class="block text-sm font-semibold mb-1">æ€§åˆ¥</label>
                        <select id="p_gender" class="w-full border rounded p-2 focus:ring-2 focus:ring-indigo-500 outline-none">
                            <option value="å¥³">å¥³æ€§</option>
                            <option value="ç”·">ç”·æ€§</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-semibold mb-1">ã”å®¶æ—ã¨ã®ç¶šæŸ„</label>
                        <input type="text" id="p_relation" class="w-full border rounded p-2 focus:ring-2 focus:ring-indigo-500 outline-none" placeholder="ä¾‹ï¼šé•·ç”·ã€é•·å¥³">
                    </div>
                    <div>
                        <label class="block text-sm font-semibold mb-1">åŒå±…ã®æœ‰ç„¡</label>
                        <select id="p_living" class="w-full border rounded p-2 focus:ring-2 focus:ring-indigo-500 outline-none">
                            <option value="ã¯ã„">ã¯ã„ï¼ˆåŒå±…ï¼‰</option>
                            <option value="ã„ã„ãˆ">ã„ã„ãˆï¼ˆåˆ¥å±…ï¼‰</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-semibold mb-1">é¢ä¼šãƒ»è¨ªå•é »åº¦ï¼ˆé€±å˜ä½ï¼‰</label>
                        <input type="number" id="p_visit" class="w-full border rounded p-2 focus:ring-2 focus:ring-indigo-500 outline-none" placeholder="é€± ( ) å›">
                    </div>
                    <div>
                        <label class="block text-sm font-semibold mb-1">è©•ä¾¡å®Ÿæ–½æ—¥</label>
                         <input type="text" id="test_date" class="w-full border rounded p-2 focus:ring-2 focus:ring-indigo-500 outline-none" placeholder="YYYYMMDD">
                    </div>
                    <div>
                        <label class="block text-sm font-semibold mb-1">æ‹…å½“è€…ï¼ˆä½œæˆè€…ï¼‰</label>
                        <input type="text" id="admin_name" class="w-full border rounded p-2 focus:ring-2 focus:ring-indigo-500 outline-none" placeholder="æ‹…å½“è€…å">
                    </div>
                </div>
            </section>

            <!-- Section 2: KNPI-Q è¨­å• -->
            <section class="mb-10">
                <div class="bg-gray-50 p-6 rounded-lg mb-6 border-l-4 border-indigo-500">
                    <h3 class="font-bold text-lg mb-2">â€» è©•ä¾¡åŸºæº–ãŠã‚ˆã³æ¡ç‚¹æ–¹æ³•</h3>
                    <p class="text-sm text-gray-600 leading-relaxed italic">
                        éå»1ãƒ¶æœˆé–“ã®å¤‰åŒ–ã«ã¤ã„ã¦å›ç­”ã—ã¦ãã ã•ã„ã€‚<b>é‡ç—‡åº¦</b>ï¼ˆ1:è»½åº¦ã€2:ä¸­ç­‰åº¦ã€3:é«˜åº¦ï¼‰ã¨ 
                        <b>ä»‹è­·è€…ã®è² æ‹…åº¦</b>ï¼ˆ0:å…¨ããªã— ã€œ 5:è‘—ã—ãé«˜åº¦ï¼‰ã‚’ãã‚Œãã‚Œé¸æŠã—ã¾ã™ã€‚å„é …ç›®ã®ã‚¹ã‚³ã‚¢ã¯ã€ã“ã‚Œã‚‰2ã¤ã®å€¤ã®ç©ã§ç®—å‡ºã•ã‚Œã¾ã™ã€‚
                    </p>
                </div>

                <div id="knpi_form" class="space-y-4">
                    <!-- JSã§è¨­å•ã‚’ç”Ÿæˆ -->
                </div>

                <div class="mt-10">
                    <button onclick="saveAndCalculate()" class="w-full bg-indigo-700 text-white py-4 rounded-xl font-bold text-lg hover:bg-indigo-800 transition shadow-lg">
                        è©•ä¾¡çµæœã‚’ç¢ºèªã—ã¦ä¿å­˜ã™ã‚‹
                    </button>
                </div>
            </section>

            <!-- Section 3: çµæœåˆ†æ -->
            <section id="analysis_section" class="hidden mb-10 card p-8 bg-white border-2 border-indigo-100">
                <h2 class="text-2xl font-bold mb-6 text-indigo-900 border-b pb-2">ğŸ“Š BPSD è©³ç´°åˆ†æçµæœ</h2>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 items-center">
                    <div class="flex justify-center">
                        <canvas id="bpsdChart" style="max-width: 450px; max-height: 450px;"></canvas>
                    </div>
                    <div class="space-y-6">
                        <div class="bg-indigo-50 p-6 rounded-xl border border-indigo-200">
                            <h3 class="font-bold text-indigo-800 mb-2">ğŸ“‹ å°‚é–€å®¶ã«ã‚ˆã‚‹åˆ†ææ‰€è¦‹</h3>
                            <p id="expert_opinion" class="text-gray-700 leading-relaxed text-lg">
                                <!-- åˆ†ææ‰€è¦‹ãŒè‡ªå‹•ç”Ÿæˆã•ã‚Œã¾ã™ -->
                            </p>
                        </div>
                        <div id="history_view" class="grid grid-cols-2 gap-4">
                            <!-- å±¥æ­´ã‚µãƒãƒªãƒ¼ -->
                        </div>
                    </div>
                </div>
                <div class="mt-10">
                    <button onclick="generatePlan()" class="w-full bg-emerald-600 text-white py-5 rounded-xl font-bold text-xl hover:bg-emerald-700 transition animate-pulse shadow-lg">
                        å€‹äººåˆ¥ 2026å¹´åº¦ ã‚±ã‚¢ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’è¨­è¨ˆã™ã‚‹
                    </button>
                </div>
            </section>

            <!-- Section 4: ãƒ—ãƒ­ã‚°ãƒ©ãƒ è¨ˆç”» -->
            <section id="program_plan" class="hidden">
                <div class="flex justify-between items-center mb-8 border-b-4 border-emerald-500 pb-4">
                    <h2 class="text-3xl font-bold text-indigo-900 italic uppercase">2026 Monthly BPSD Care Plan</h2>
                    <button onclick="window.print()" class="bg-gray-100 hover:bg-gray-200 px-4 py-2 rounded-lg font-bold text-sm">ğŸ–¨ï¸ è¨ˆç”»æ›¸ã‚’å°åˆ·ã™ã‚‹</button>
                </div>
                <div id="plan_grid" class="space-y-12">
                    <!-- æœˆåˆ¥ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’ç”Ÿæˆ -->
                </div>
            </section>
        </main>
    </div>

    <script>
        const domains = [
            { id: 1, title: "å¦„æƒ³", desc: "è‡ªåˆ†ã®ç‰©ãŒç›—ã¾ã‚ŒãŸã¨ä¿¡ã˜è¾¼ã‚“ã ã‚Šã€èª°ã‹ãŒè‡ªåˆ†ã‚’å‚·ã¤ã‘ã‚ˆã†ã¨ã—ã¦ã„ã‚‹ã¨èª¤è§£ã—ã¦ã„ã¾ã™ã‹ï¼Ÿ" },
            { id: 2, title: "å¹»è¦š", desc: "èª°ã‹ã®å£°ãŒèã“ãˆã‚‹ã‚ˆã†ãªä»•è‰ã‚’ã—ãŸã‚Šã€èª°ã‚‚ã„ãªã„ã®ã«ä¼šè©±ã‚’ã—ãŸã‚Šã—ã¾ã™ã‹ï¼Ÿ" },
            { id: 3, title: "ç„¦ç‡¥ãƒ»æ”»æ’ƒæ€§", desc: "é ‘å›ºã«ãªã£ãŸã‚Šã€å‘¨å›²ã®åŠ©ã‘ã«å¯¾ã—ã¦æŠµæŠ—ã—ãŸã‚Šã—ã¾ã™ã‹ï¼Ÿ" },
            { id: 4, title: "æŠ‘ã†ã¤ãƒ»æ°—åˆ†ä½ä¸‹", desc: "æ‚²ã—ãã†ã«ã—ã¦ã„ãŸã‚Šã€æ°—åˆ†ãŒæ²ˆã‚“ã§ã„ã‚‹ã‚ˆã†ã«è¦‹ãˆã¾ã™ã‹ï¼Ÿ æ³£ãã“ã¨ã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿ" },
            { id: 5, title: "ä¸å®‰", desc: "ä»‹è­·è€…ã¨é›¢ã‚Œã‚‹ã¨ä¸å®‰ãŒã£ãŸã‚Šã€æ€’ã£ãŸã‚Šã—ã¾ã™ã‹ï¼Ÿ éå¸¸ã«ç·Šå¼µã—ã¦ã„ã‚‹ã‚ˆã†ã«è¦‹ãˆã¾ã™ã‹ï¼Ÿ" },
            { id: 6, title: "å¤šå¹¸æ„Ÿ", desc: "ç‰¹åˆ¥ãªç†ç”±ã‚‚ãªãéåº¦ã«å¹¸ã›ãã†ã«è¦‹ãˆãŸã‚Šã€æ°—åˆ†ãŒè‰¯ã™ããŸã‚Šã—ã¾ã™ã‹ï¼Ÿ" },
            { id: 7, title: "ç„¡é–¢å¿ƒï¼ˆã‚¢ãƒ‘ã‚·ãƒ¼ï¼‰", desc: "æ—¥å¸¸ç”Ÿæ´»ã¸ã®é–¢å¿ƒãŒæ¸›ã£ãŸã‚Šã€ä»–äººã®æ´»å‹•ã«èˆˆå‘³ã‚’ç¤ºã•ãªããªã£ãŸã‚Šã—ã¾ã—ãŸã‹ï¼Ÿ" },
            { id: 8, title: "è„±æŠ‘åˆ¶", desc: "è¡å‹•çš„ã«è¡Œå‹•ã—ãŸã‚Šã€è¦‹çŸ¥ã‚‰ã¬äººã«å¯¾ã—ã¦å¤±ç¤¼ãªæ…‹åº¦ã‚’ã¨ã£ãŸã‚Šã—ã¾ã™ã‹ï¼Ÿ" },
            { id: 9, title: "æ˜“åˆºæ¿€æ€§ï¼ˆã„ã‚‰ã ã¡ï¼‰", desc: "ç„¦ã‚Šã‚’æ„Ÿã˜ã‚„ã™ã‹ã£ãŸã‚Šã€äº›ç´°ãªã“ã¨ã§æ€’ã£ãŸã‚Šã—ã¾ã™ã‹ï¼Ÿ äºˆå®šãŒé…ã‚Œã‚‹ã®ã‚’å¾…ã¦ã¾ã›ã‚“ã‹ï¼Ÿ" },
            { id: 10, title: "ç•°å¸¸ãªåå¾©è¡Œå‹•", desc: "ç›®çš„ãªãæ­©ãå›ã£ãŸã‚Šã€å¼•ãå‡ºã—ã‚’ä½•åº¦ã‚‚é–‹ã‘é–‰ã‚ã™ã‚‹ãªã©ã®ç¹°ã‚Šè¿”ã—è¡Œå‹•ãŒã‚ã‚Šã¾ã™ã‹ï¼Ÿ" },
            { id: 11, title: "ç¡çœ éšœå®³", desc: "å¤œä¸­ã«ç›®ã‚’è¦šã¾ã—ã¦äººã‚’èµ·ã“ã—ãŸã‚Šã€æ—©æœã«èµ·ãã™ããŸã‚Šã€æ˜¼å¯ãŒå¤šã™ããŸã‚Šã—ã¾ã™ã‹ï¼Ÿ" },
            { id: 12, title: "é£Ÿè¡Œå‹•ã®ç•°å¸¸", desc: "ä½“é‡ã®å¤‰åŒ–ãŒã‚ã£ãŸã‚Šã€å¥½ããªé£Ÿã¹ç‰©ã®ç¨®é¡ãŒæ€¥ã«å¤‰ã‚ã£ãŸã‚Šã—ã¾ã—ãŸã‹ï¼Ÿ" }
        ];

        // æ—¥æœ¬ã®æ–‡åŒ–ã«åˆã‚ã›ãŸå°‚é–€ãƒ—ãƒ­ã‚°ãƒ©ãƒ DB
        const extendedDB = {
            1: [ // å¦„æƒ³/å¹»è¦šã‚¿ãƒ¼ã‚²ãƒƒãƒˆ
                { name: "ãƒªã‚¢ãƒªãƒ†ã‚£ãƒ»ã‚ªãƒªã‚¨ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³æ²ç¤ºæ¿", method: "æ—¥ä»˜ã€å­£ç¯€ã€å ´æ‰€ã‚’æ¯æœä¸€ç·’ã«ç¢ºèªã™ã‚‹", effect: "è¦‹å½“è­˜ã®ç¶­æŒãŠã‚ˆã³ç¾å®Ÿèªè­˜ã®å¼·åŒ–", cat: "èªçŸ¥" },
                { name: "å®‰å¿ƒçµµåˆã‚ã›", method: "é¦´æŸ“ã¿ã®ã‚ã‚‹æ—¥ç”¨å“ã‚«ãƒ¼ãƒ‰ã‚’ç”¨ã„ãŸè¦–è¦šåˆºæ¿€", effect: "çŸ¥è¦šã®æ­ªã¿ã‚’æŠ‘åˆ¶ã—æƒ…ç·’ã‚’å®‰å®šã•ã›ã‚‹", cat: "èªçŸ¥" },
                { name: "è‡ªç„¶éŸ³ãƒ»ç’°å¢ƒéŸ³ç™‚æ³•", method: "æ•…éƒ·ã®é¢¨æ™¯ã‚„è‡ªç„¶ã®éŸ³ã‚’è´ã", effect: "å¹»è´ã®é »åº¦æ¸›å°‘ãŠã‚ˆã³ãƒªãƒ©ãƒƒã‚¯ã‚¹åŠ¹æœ", cat: "éŸ³æ¥½" },
                { name: "ãªã˜ã¿ã®å“å›æƒ³", method: "å€‹äººçš„ã«æ„å‘³ã®ã‚ã‚‹æ€ã„å‡ºã®å“ã«è§¦ã‚Œã‚‹", effect: "è‡ªå·±ã‚¢ã‚¤ãƒ‡ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã®å¼·åŒ–ã¨å¦„æƒ³ã®æŠ‘åˆ¶", cat: "æ„Ÿè¦š" },
                { name: "æˆ‘ãŒå®¶ã®é–“å–ã‚Šæã", method: "ä½ã¿æ…£ã‚ŒãŸç©ºé–“ã®æ§‹é€ ã‚’æ€ã„å‡ºã—ãªãŒã‚‰æã", effect: "ç©ºé–“èªçŸ¥èƒ½åŠ›ã®å›å¾©ã¨ä¸å®‰ã®ç·©å’Œ", cat: "ã‚¢ãƒ¼ãƒˆ" },
                { name: "å®šæœŸçš„ãªå®‰å¿ƒå£°æ›ã‘ãƒ«ãƒ¼ãƒãƒ³", method: "æ±ºã¾ã£ãŸæ™‚é–“ã«å£°æ›ã‘ã‚’è¡Œã„ã€å¯¾è©±ã‚’å¢—ã‚„ã™", effect: "è¢«å®³å¦„æƒ³ã®ç·©å’Œã¨ä¿¡é ¼é–¢ä¿‚ã®æ§‹ç¯‰", cat: "å¿ƒç†" },
                { name: "å®¶æ—ã‚¢ãƒ«ãƒãƒ ã®é–²è¦§", method: "å®¶æ—ã¨ã®é–¢ä¿‚ã‚’å†ç¢ºèªã™ã‚‹æ´»å‹•", effect: "å¯¾äººé–¢ä¿‚ã«åŸºã¥ãç¾å®Ÿæ„Ÿã®å¢—é€²", cat: "å›æƒ³" }
            ],
            3: [ // æ”»æ’ƒæ€§/ç„¦ç‡¥/æ˜“åˆºæ¿€æ€§ã‚¿ãƒ¼ã‚²ãƒƒãƒˆ
                { name: "ãƒ©ãƒ™ãƒ³ãƒ€ãƒ¼ãƒ»ã‚¢ãƒ­ãƒãƒãƒ³ãƒ‰ãƒãƒƒã‚µãƒ¼ã‚¸", method: "æ‰‹è¶³ã«å„ªã—ã„åœ§ã‚’ã‹ã‘ãªãŒã‚‰é¦™ã‚Šã§ç™’ã‚„ã™", effect: "ç„¦ç‡¥æ„Ÿã®è»½æ¸›ã¨å‰¯äº¤æ„Ÿç¥çµŒã®æ´»æ€§åŒ–", cat: "æ„Ÿè¦š" },
                { name: "ç²˜åœŸç´°å·¥ãƒ»é™¶èŠ¸ä½“é¨“", method: "æ‰‹ã®ã²ã‚‰ã§ã“ã­ãŸã‚Šå½¢ã‚’ä½œã£ãŸã‚Šã™ã‚‹", effect: "è² ã®ã‚¨ãƒãƒ«ã‚®ãƒ¼ã®ç™ºæ•£ã¨ã‚¹ãƒˆãƒ¬ã‚¹ç·©å’Œ", cat: "ã‚¢ãƒ¼ãƒˆ" },
                { name: "ã‚¯ãƒ©ã‚·ãƒƒã‚¯éŸ³æ¥½ã¨æ·±å‘¼å¸", method: "ç©ã‚„ã‹ãªæ—‹å¾‹ã«åˆã‚ã›ã¦è…¹å¼å‘¼å¸ã‚’è¡Œã†", effect: "å¿ƒæ‹æ•°ã®å®‰å®šã¨çªç™ºçš„è¡Œå‹•ã®æŠ‘åˆ¶", cat: "éŸ³æ¥½" },
                { name: "ã‚¿ã‚ªãƒ«ç•³ã¿ã®æ‰‹ä¼ã„", method: "ç¹°ã‚Šè¿”ã—ã®å®¶äº‹å‹•ä½œã‚’å½¹å‰²ã¨ã—ã¦ä¾é ¼ã™ã‚‹", effect: "ã‚¨ãƒãƒ«ã‚®ãƒ¼ã®åˆ†æ•£ã¨è‡ªå·±æœ‰ç”¨æ„Ÿã®ä»˜ä¸", cat: "ç”Ÿæ´»" },
                { name: "è¶³æ¹¯ã‚»ãƒ©ãƒ”ãƒ¼", method: "é©æ¸©ã®æ¹¯ã«è¶³ã‚’æµ¸ã—ã¦ãƒªãƒ©ãƒƒã‚¯ã‚¹ã™ã‚‹", effect: "å…¨èº«ã®å¼›ç·©ã¨èº«ä½“çš„ç·Šå¼µã®è§£æ¶ˆ", cat: "èº«ä½“" },
                { name: "ãƒœã‚¿ãƒ³ã®ä»•åˆ†ã‘ä½œæ¥­", method: "å¤§ãã•ã‚„è‰²ã®ç•°ãªã‚‹ãƒœã‚¿ãƒ³ã‚’å®¹å™¨ã«åˆ†ã‘ã‚‹", effect: "æ³¨æ„åŠ›ã®é›†ä¸­ã«ã‚ˆã‚‹ç„¦ç‡¥è¡Œå‹•ã®è»¢ç§»", cat: "èªçŸ¥" },
                { name: "ã‚¹ãƒãƒ³ã‚¸ãƒœãƒ¼ãƒ«æŠ•ã’", method: "æŸ”ã‚‰ã‹ã„ãƒœãƒ¼ãƒ«ã‚’çš„ã«å‘ã‹ã£ã¦æŠ•ã’ã‚‹", effect: "èº«ä½“çš„ãªæ€’ã‚Š(Anger)ã®å®‰å…¨ãªç™ºæ•£", cat: "èº«ä½“" }
            ],
            4: [ // æŠ‘ã†ã¤/æ°—åˆ†ä½ä¸‹/ç„¡é–¢å¿ƒã‚¿ãƒ¼ã‚²ãƒƒãƒˆ
                { name: "è‡ªåˆ†å²ãƒ•ã‚©ãƒˆãƒ–ãƒƒã‚¯ä½œæˆ", method: "è¼ã„ã¦ã„ãŸç¬é–“ã®å†™çœŸã¨ã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰ã‚’ç¶´ã‚‹", effect: "è‡ªå°Šå¿ƒã®å‘ä¸Šã¨æŠ‘ã†ã¤æ„Ÿã®æ”¹å–„", cat: "å›æƒ³" },
                { name: "åœ’èŠ¸ãƒ»æ¤ç‰©ã®ä¸–è©±ä¿‚", method: "æˆé•·ã®æ—©ã„æ¤ç‰©ã«æ¯æ—¥æ°´ã‚’ã‚„ã‚‹", effect: "ç”Ÿå‘½ã¸ã®æ„›ç€ã¨æ—¥å¸¸ã®æ„æ¬²å‘ä¸Š", cat: "åœ’èŠ¸" },
                { name: "æ—¥å…‰æµ´ã‚’å…¼ã­ãŸæ•£æ­©", method: "åˆå‰10æ™‚é ƒã«ã‚»ãƒ­ãƒˆãƒ‹ãƒ³åˆæˆã‚’ä¿ƒã™", effect: "æƒ…ç·’çš„æ´»åŠ›ã®ä»˜ä¸ã¨æ°—åˆ†ã®è½ã¡è¾¼ã¿é˜²æ­¢", cat: "èº«ä½“" },
                { name: "æ„Ÿè¬æ—¥è¨˜ã®ä»£ç­†", method: "ä»Šæ—¥ã‚ã£ãŸè‰¯ã„ã“ã¨ã‚’ä¸€ã¤ã ã‘è©±ã—ã¦ã‚‚ã‚‰ã†", effect: "è‚¯å®šçš„æ€è€ƒã®èª˜å°ã¨å­¤ç«‹æ„Ÿã®è§£æ¶ˆ", cat: "å¿ƒç†" },
                { name: "æ˜”éŠã³ãƒ»ã‘ã‚“ç‰/ãŠæ‰‹ç‰", method: "ä¸€ç·’ã«å¿œæ´ã—ãªãŒã‚‰ç›®æ¨™ã‚’é”æˆã™ã‚‹", effect: "ç¤¾ä¼šçš„ç›¸äº’ä½œç”¨ã¨æ¥½ã—ã¿ã®æä¾›", cat: "èº«ä½“" },
                { name: "ç”Ÿã‘èŠ±ä½“é¨“", method: "å­£ç¯€ã®èŠ±ã‚’ç“¶ã«ç”Ÿã‘ã€é…ç½®ã‚’æ¥½ã—ã‚€", effect: "æ„Ÿè¦šçš„ãªå–œã³ã¨å¿ƒç†çš„æº€è¶³æ„Ÿ", cat: "ã‚¢ãƒ¼ãƒˆ" },
                { name: "æ˜­å’Œã®æ­Œè¬¡æ›²ãƒ»åˆå”±", method: "æ„›å”±æ­Œã®æ­Œè©ã‚’è¦‹ãªãŒã‚‰ä¸€ç·’ã«æ­Œã†", effect: "ã‚¨ãƒ³ãƒ‰ãƒ«ãƒ•ã‚£ãƒ³ã®åˆ†æ³Œã¨æƒ…ç·’çš„ç´å¸¯ã®å¼·åŒ–", cat: "éŸ³æ¥½" }
            ],
            10: [ // åå¾©è¡Œå‹•/è„±æŠ‘åˆ¶ã‚¿ãƒ¼ã‚²ãƒƒãƒˆ
                { name: "ç³¸å·»ããƒ»ç³¸è§£ãä½œæ¥­", method: "çµ¡ã¾ã£ãŸç³¸ã‚’ãã‚Œã„ã«å·»ãç›´ã™", effect: "ç„¡æ„å‘³ãªç¹°ã‚Šè¿”ã—ã‚’æœ‰æ„ç¾©ãªæ´»å‹•ã¸è»¢æ›", cat: "èªçŸ¥" },
                { name: "æ‰‹è§¦ã‚Šç´ æã®æ„Ÿè§¦ä½“é¨“", method: "æ§˜ã€…ãªå¸ƒåœ°ã‚„å°è±†ã®æ„Ÿè§¦ã‚’æŒ‡å…ˆã§æ„Ÿã˜ã‚‹", effect: "è§¦è¦šåˆºæ¿€ã®å……è¶³ã¨å¾˜å¾Šè¡Œå‹•ã®æ¸›å°‘", cat: "æ„Ÿè¦š" },
                { name: "è±†ã®é¸åˆ¥ï¼ˆé»’è±†ã¨ç™½è±†ï¼‰", method: "äºŒç¨®é¡ã®è±†ã‚’ã‚«ãƒƒãƒ—ã«åˆ†é¡ã™ã‚‹", effect: "å¾®ç´°é‹å‹•ã¸ã®é›†ä¸­ã«ã‚ˆã‚‹è¡Œå‹•åˆ¶å¾¡", cat: "èªçŸ¥" },
                { name: "ã¡ãã‚Šçµµãƒ»ã‚³ãƒ©ãƒ¼ã‚¸ãƒ¥", method: "é›‘èªŒã‚„è‰²ç´™ã‚’ç´°ã‹ãã¡ãã£ã¦è²¼ã‚‹", effect: "è¡å‹•çš„ã‚¨ãƒãƒ«ã‚®ãƒ¼ã®æ¶ˆè²»ã¨æŒ‡å…ˆã®ç¶­æŒ", cat: "ã‚¢ãƒ¼ãƒˆ" },
                { name: "ç´™èŠå±…ãƒ»èª­ã¿èã‹ã›", method: "ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ãƒ†ãƒªãƒ³ã‚°ã«ã‚ˆã‚‹è´è¦šçš„é›†ä¸­", effect: "æ•£æ¼«ã•ã®æŠ‘åˆ¶ã¨æƒ…ç·’ã®å®‰å®š", cat: "å›æƒ³" },
                { name: "ãƒªã‚ºãƒ æ‹æ‰‹", method: "ä¸€å®šã®ãƒ†ãƒ³ãƒã«åˆã‚ã›ã¦æ‰‹æ‹å­ã‚’æ‰“ã¤", effect: "è‡ªå·±èª¿ç¯€èƒ½åŠ›ã®å¼·åŒ–ã¨æ´»åŠ›å‘ä¸Š", cat: "éŸ³æ¥½" },
                { name: "é¢¨æ™¯ãƒ‘ã‚ºãƒ«ï¼ˆãƒ©ãƒ¼ã‚¸ã‚µã‚¤ã‚ºï¼‰", method: "ãƒ”ãƒ¼ã‚¹ã®å¤§ãã„é¢¨æ™¯å†™çœŸã‚’å®Œæˆã•ã›ã‚‹", effect: "è¦–è¦šçš„æ³¨æ„æŒç¶šæ™‚é–“ã®æ‹¡å¤§", cat: "èªçŸ¥" }
            ],
            11: [ // ç¡çœ /é£Ÿäº‹ã‚¿ãƒ¼ã‚²ãƒƒãƒˆ
                { name: "åˆå‰ä¸­ã®æ—¥å…‰æµ´ä½“æ“", method: "çª“éš›ã§èƒŒä¼¸ã³ã‚„é–¢ç¯€ã‚’å‹•ã‹ã™", effect: "ç”Ÿä½“ãƒªã‚ºãƒ ã®æ­£å¸¸åŒ–ã¨ç¡çœ ã®è³ªå‘ä¸Š", cat: "èº«ä½“" },
                { name: "äº”æ„Ÿåˆºæ¿€ã®å½©ã‚Šå¾¡è†³", method: "è‰²å½©è±Šã‹ãªé£Ÿæã‚’ä½¿ã„ã€è¦–è¦šã¨é¦™ã‚Šã‚’å¼·èª¿", effect: "é£Ÿæ¬²ä¸æŒ¯ã®æ”¹å–„ã¨å‘³è¦šåˆºæ¿€", cat: "é£Ÿäº‹" },
                { name: "å…¥çœ å‰ã®ãƒ’ãƒ¼ãƒªãƒ³ã‚°éŸ³æ¥½", method: "é™ã‹ãªæ³¢ã®éŸ³ã‚„ç™’ã‚„ã—ã®æ—‹å¾‹ã‚’è´ã", effect: "å…¥çœ èª˜å°ã¨å¤œé–“ä¸å®‰ã®è»½æ¸›", cat: "éŸ³æ¥½" },
                { name: "å­£ç¯€ã®ãƒ•ãƒ«ãƒ¼ãƒ„ç››ã‚Šä»˜ã‘", method: "æœç‰©ã‚’ãã‚Œã„ã«é£¾ã‚Šä»˜ã‘ã€ä»–è€…ã¨åˆ†ã‹ã¡åˆã†", effect: "é£Ÿã‚’é€šã˜ãŸäº¤æµã¨æ „é¤Šæ‘‚å–ã®ä¿ƒé€²", cat: "é£Ÿäº‹" },
                { name: "è¶³è£ãƒãƒƒã‚µãƒ¼ã‚¸ã¨ãƒãƒ¼ãƒ–ãƒ†ã‚£ãƒ¼", method: "è¶³ã‚’åˆºæ¿€ã—ãªãŒã‚‰æ¸©ã‹ã„é£²ã¿ç‰©ã‚’æ‘‚ã‚‹", effect: "å¿ƒèº«ã®å¼›ç·©ã¨å¤œé–“å¾˜å¾Šã®æŠ‘åˆ¶", cat: "æ„Ÿè¦š" },
                { name: "æ˜”ã®æ–™ç†ãƒ¬ã‚·ãƒ”è«‡ç¾©", method: "éå»ã®èª¿ç†æ³•ã‚„é£Ÿäº‹é¢¨æ™¯ã‚’èªã‚Šåˆã†", effect: "é£Ÿç¿’æ…£ã®æ˜¯æ­£ã¨æ¥½ã—ã„é£Ÿäº‹ã®é›°å›²æ°—ä½œã‚Š", cat: "å›æƒ³" },
                { name: "ãƒ©ã‚¸ã‚ªé¢¨å…¥çœ èª­ã¿èã‹ã›", method: "è½ã¡ç€ã„ãŸå£°ã§ã®èªã‚Šã‚’èãæµã™", effect: "ä¸å®‰è§£æ¶ˆã¨è‡ªç„¶ãªå…¥çœ ã®èª˜å°", cat: "éŸ³æ¥½" }
            ]
        };

        const commonDB = [
            { name: "ã“ã¨ã‚ã–å®Œæˆã‚¯ã‚¤ã‚º", method: "æç¤ºã•ã‚ŒãŸã“ã¨ã‚ã–ã®å¾ŒåŠã‚’å½“ã¦ã‚‹", effect: "è¨€èªæµæš¢æ€§ã¨çŸ­æœŸè¨˜æ†¶ã®ç¶­æŒ", cat: "èªçŸ¥" },
            { name: "é–“é•ã„æ¢ã—", method: "äºŒã¤ã®çµµã®é–“ã®å¾®ç´°ãªé•ã„ã‚’è¦‹ã¤ã‘ã‚‹", effect: "è¦–çŸ¥è¦šçš„é›†ä¸­åŠ›ã¨å‡¦ç†é€Ÿåº¦ã®å‘ä¸Š", cat: "èªçŸ¥" },
            { name: "å’ŒæŸ„ã®å¡—ã‚Šçµµ", method: "ä¼çµ±çš„ãªæ¨¡æ§˜ã«è‰²ã‚’ä»˜ã‘ã¦ã„ã", effect: "å‰µé€ çš„è¡¨ç¾ã¨é”æˆæ„Ÿã®ä»˜ä¸", cat: "ã‚¢ãƒ¼ãƒˆ" },
            { name: "é€£æƒ³ã‚²ãƒ¼ãƒ ", method: "æç¤ºã•ã‚ŒãŸå˜èªã‹ã‚‰é€£æƒ³ã™ã‚‹è¨€è‘‰ã‚’è¨€ã†", effect: "æ€è€ƒã®æŸ”è»Ÿæ€§ã¨èªå½™åŠ›ã®åˆºæ¿€", cat: "èªçŸ¥" },
            { name: "æŒ‡ä½“æ“ãƒ»æŒ‡ã®æ•°éŠã³", method: "ä¸¡æ‰‹ã§ç•°ãªã‚‹æ•°å­—ã‚’è¡¨ç¾ã™ã‚‹", effect: "å·¦å³è„³ã®å”èª¿ã¨èªçŸ¥æ©Ÿèƒ½ã®å¼·åŒ–", cat: "èº«ä½“" },
            { name: "çµµã‚«ãƒ¼ãƒ‰åˆã‚ã›", method: "ä¼ã›ãŸã‚«ãƒ¼ãƒ‰ã‹ã‚‰åŒã˜çµµæŸ„ã‚’é¸ã¶", effect: "ãƒ¯ãƒ¼ã‚­ãƒ³ã‚°ãƒ¡ãƒ¢ãƒªã®æ”¹å–„", cat: "èªçŸ¥" },
            { name: "ã‚¯ãƒ­ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒ‘ã‚ºãƒ«", method: "ãƒ’ãƒ³ãƒˆã‚’èª­ã¿ã€ãƒã‚¹ã‚’åŸ‹ã‚ã¦ã„ã", effect: "è«–ç†çš„æ€è€ƒã®ç¶­æŒ", cat: "èªçŸ¥" },
            { name: "å­£ç¯€ã®è²¼ã‚Šçµµ", method: "å­£ç¯€ã«ã¡ãªã‚“ã ç´ æã‚’è²¼ã‚Šä»˜ã‘ã‚‹", effect: "å­£ç¯€æ„Ÿã®é†¸æˆã¨å¾®ç´°é‹å‹•", cat: "ã‚¢ãƒ¼ãƒˆ" },
            { name: "ã‚ã‚„ã¨ã‚Š", method: "ä»‹è­·è€…ã¨ä¸€ç·’ã«ç´ã§å½¢ã‚’ä½œã‚‹", effect: "å”èª¿æ€§ã¨ç©ºé–“èªçŸ¥ã®ç¶­æŒ", cat: "ç”Ÿæ´»" },
            { name: "ãƒ‹ãƒ¥ãƒ¼ã‚¹è¦ç´„ãƒˆãƒ¼ã‚¯", method: "ä»Šæ—¥ã®ä¸»ãªãƒ‹ãƒ¥ãƒ¼ã‚¹ã‚’çŸ­ãä¼ãˆã‚‹", effect: "æœ€æ–°æƒ…å ±ã®å—å®¹ã¨ç¾å®Ÿè¦‹å½“è­˜", cat: "èªçŸ¥" },
            { name: "é¦™ã‚Šè¢‹ï¼ˆã‚µã‚·ã‚§ï¼‰ä½œã‚Š", method: "ä¹¾ç‡¥ã•ã›ãŸèŠ±ã³ã‚‰ã‚’è¢‹ã«è©°ã‚ã‚‹", effect: "å—…è¦šåˆºæ¿€ã¨æƒ…ç·’çš„æº€è¶³", cat: "æ„Ÿè¦š" },
            { name: "èŒ¶é“ä½“é¨“ï¼ˆç°¡æ˜“å¼ï¼‰", method: "ãŠèŒ¶ã‚’ç‚¹ã¦ã¦å‘³ã‚ã†é™ã‹ãªæ™‚é–“", effect: "é›†ä¸­åŠ›ã®å¼·åŒ–ã¨ç¤¼å„€ä½œæ³•ã¸ã®åˆºæ¿€", cat: "ç”Ÿæ´»" },
            { name: "é¢¨èˆ¹ãƒãƒ¬ãƒ¼", method: "æ¤…å­ã«åº§ã£ãŸã¾ã¾é¢¨èˆ¹ã‚’æ‰“ã¡åˆã†", effect: "ä¸ŠåŠèº«ã®ç­‹åŠ›ã¨åå¿œé€Ÿåº¦ã®å‘ä¸Š", cat: "èº«ä½“" },
            { name: "ã‚¤ãƒ³ãƒˆãƒ­ã‚¯ã‚¤ã‚º", method: "æ›²ã®å†’é ­ã‚’è´ã„ã¦æ›²åã‚’å½“ã¦ã‚‹", effect: "è´è¦šçš„è­˜åˆ¥åŠ›ã¨æ¥½ã—ã¿ã®å…±æœ‰", cat: "éŸ³æ¥½" },
            { name: "æ°—åŠŸãƒ»å¤ªæ¥µæ‹³é¢¨ä½“æ“", method: "ã‚†ã£ãã‚Šã¨ã—ãŸå‹•ä½œã§å…¨èº«ã‚’ä¼¸ã°ã™", effect: "èº«ä½“ãƒãƒ©ãƒ³ã‚¹ã¨æŸ”è»Ÿæ€§ã®å¢—å¤§", cat: "èº«ä½“" }
        ];

        const form = document.getElementById('knpi_form');
        domains.forEach(d => {
            const div = document.createElement('div');
            div.className = "p-5 border rounded-xl bg-white shadow-sm flex flex-wrap items-center gap-4 justify-between";
            div.innerHTML = `
                <div class="flex-1 min-w-[300px]">
                    <h4 class="font-bold text-indigo-900">${d.id}. ${d.title}</h4>
                    <p class="text-sm text-gray-500">${d.desc}</p>
                </div>
                <div class="flex gap-4 items-center">
                    <label class="flex items-center gap-1 text-xs font-bold">ç—‡çŠ¶ã®æœ‰ç„¡<input type="checkbox" class="npi-check w-5 h-5" data-id="${d.id}"></label>
                    <div class="flex flex-col">
                        <span class="text-[10px] text-gray-400">é‡ç—‡åº¦(1-3)</span>
                        <select class="npi-sev border rounded p-1 text-sm"><option value="1">1</option><option value="2">2</option><option value="3">3</option></select>
                    </div>
                    <div class="flex flex-col">
                        <span class="text-[10px] text-gray-400">è² æ‹…åº¦(0-5)</span>
                        <select class="npi-dis border rounded p-1 text-sm"><option value="0">0</option><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option></select>
                    </div>
                </div>
            `;
            form.appendChild(div);
        });

        let history = [];
        let bpsdChart = null;

        function saveAndCalculate() {
            const name = document.getElementById('p_name').value;
            if(!name) { alert("åˆ©ç”¨è€…æ§˜ã®ãŠåå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚"); return; }
            
            const checks = document.querySelectorAll('.npi-check');
            const sevs = document.querySelectorAll('.npi-sev');
            const diss = document.querySelectorAll('.npi-dis');
            
            let currentScores = [];
            let total = 0;

            checks.forEach((c, i) => {
                if(c.checked) {
                    const s = parseInt(sevs[i].value) * parseInt(diss[i].value);
                    currentScores.push(s);
                    total += s;
                } else {
                    currentScores.push(0);
                }
            });

            const entry = { name, date: document.getElementById('test_date').value || '2026-01-01', total, scores: currentScores };
            history.push(entry);

            const maxIdx = currentScores.indexOf(Math.max(...currentScores));
            const opinion = `ç¾åœ¨ã€${name}æ§˜ã¯ã€Œ${domains[maxIdx].title}ã€ã®é ˜åŸŸã§æœ€ã‚‚é«˜ã„æ•°å€¤ã‚’ç¤ºã—ã¦ãŠã‚Šã€ã“ã‚Œã«é–¢é€£ã—ãŸé›†ä¸­çš„ãªéè–¬ç‰©ç™‚æ³•ã«ã‚ˆã‚‹ä»‹å…¥ãŒå¿…è¦ã§ã™ã€‚ 
            KNPI-Qã®ç·å¾—ç‚¹ã¯${total}ç‚¹ã§ã‚ã‚Šã€é«˜ãƒªã‚¹ã‚¯ç¾¤ã®ç®¡ç†ã¨ã—ã¦é€±æ¬¡ã§è¨­è¨ˆã•ã‚ŒãŸãƒ‘ãƒ¼ã‚½ãƒŠãƒ©ã‚¤ã‚ºãƒ»ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’é€šã˜ã¦ç—‡çŠ¶ã®ç·©å’Œã‚’å›³ã‚Šã¾ã™ã€‚ 
            ç‰¹ã«ã€Œ${domains[maxIdx].title}ã€ç—‡çŠ¶è»½æ¸›ã®ãŸã‚ã®æ´»å‹•ã‚’å‰åŠæœŸã«é‡ç‚¹é…ç½®ã—ã€ä»‹è­·è€…ã®è² æ‹…è»½æ¸›ã¨ã”æœ¬äººã®æƒ…ç·’çš„å®‰å®šã‚’èª˜å°ã—ã¾ã™ã€‚`;
            
            document.getElementById('expert_opinion').innerText = opinion;
            document.getElementById('analysis_section').classList.remove('hidden');
            
            drawChart(currentScores);
            updateHistoryUI(name);
            window.scrollTo({ top: document.getElementById('analysis_section').offsetTop - 50, behavior: 'smooth' });
        }

        function drawChart(data) {
            const ctx = document.getElementById('bpsdChart').getContext('2d');
            if(bpsdChart) bpsdChart.destroy();
            bpsdChart = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: domains.map(d => d.title),
                    datasets: [{
                        label: 'é ˜åŸŸåˆ¥ BPSD å¼·åº¦',
                        data: data,
                        backgroundColor: 'rgba(79, 70, 229, 0.2)',
                        borderColor: 'rgb(79, 70, 229)',
                        borderWidth: 3,
                        pointBackgroundColor: 'rgb(79, 70, 229)'
                    }]
                },
                options: { scales: { r: { beginAtZero: true, max: 15, ticks: { display: false } } } }
            });
        }

        function updateHistoryUI(name) {
            const view = document.getElementById('history_view');
            view.innerHTML = history.filter(h => h.name === name).map(h => `
                <div class="bg-white p-3 rounded-lg border shadow-sm">
                    <p class="text-[10px] text-gray-400">${h.date}</p>
                    <p class="font-bold text-indigo-600">${h.total} ç‚¹</p>
                </div>
            `).join('');
        }

        function generatePlan() {
            const planGrid = document.getElementById('plan_grid');
            document.getElementById('program_plan').classList.remove('hidden');
            planGrid.innerHTML = "";
            const lastData = history[history.length - 1];
            
            const sortedIndices = lastData.scores.map((s, i) => ({s, i})).sort((a, b) => b.s - a.s);
            const primarySymptomId = sortedIndices[0].i + 1;
            const secondarySymptomId = sortedIndices[1].s > 0 ? sortedIndices[1].i + 1 : null;

            let targetPool = [];
            if(extendedDB[primarySymptomId]) targetPool.push(...extendedDB[primarySymptomId]);
            if(secondarySymptomId && extendedDB[secondarySymptomId]) targetPool.push(...extendedDB[secondarySymptomId]);
            
            const finalPool = [...targetPool, ...commonDB];
            const months = ["1æœˆ", "2æœˆ", "3æœˆ", "4æœˆ", "5æœˆ", "6æœˆ", "7æœˆ", "8æœˆ", "9æœˆ", "10æœˆ", "11æœˆ", "12æœˆ"];
            
            months.forEach((month, mIdx) => {
                const mDiv = document.createElement('div');
                mDiv.className = "bg-slate-50 p-6 rounded-2xl border-l-8 border-emerald-500 shadow-sm";
                mDiv.innerHTML = `<h3 class="text-2xl font-bold mb-6 text-gray-800">ğŸ“… ${month} å€‹åˆ¥ã‚±ã‚¢ãƒ—ãƒ­ã‚°ãƒ©ãƒ </h3>`;
                
                const wGrid = document.createElement('div');
                wGrid.className = "grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6";

                for(let w=1; w<=4; w++) {
                    const progIdx = (mIdx * 4 + (w - 1)) % finalPool.length;
                    const prog = finalPool[progIdx];
                    
                    const wDiv = document.createElement('div');
                    wDiv.className = "bg-white p-5 rounded-xl border hover:border-emerald-500 transition shadow-sm flex flex-col justify-between h-full";
                    wDiv.innerHTML = `
                        <div>
                            <div class="flex justify-between items-center mb-3">
                                <span class="text-xs font-bold bg-indigo-100 text-indigo-700 px-2 py-1 rounded">ç¬¬ ${w} é€±</span>
                                <span class="text-[10px] font-bold text-emerald-600 uppercase tracking-wider">${prog.cat}</span>
                            </div>
                            <h4 class="font-bold text-gray-900 mb-2 text-lg">${prog.name}</h4>
                            <p class="text-sm text-gray-600 leading-snug mb-4"><b>å†…å®¹:</b> ${prog.method}</p>
                        </div>
                        <div class="pt-3 border-t border-dashed">
                            <p class="text-[11px] text-blue-600 font-bold italic">ğŸ“ æœŸå¾…ã•ã‚Œã‚‹åŠ¹æœ: ${prog.effect}</p>
                        </div>
                    `;
                    wGrid.appendChild(wDiv);
                }
                mDiv.appendChild(wGrid);
                planGrid.appendChild(mDiv);
            });
            window.scrollTo({ top: planGrid.offsetTop - 50, behavior: 'smooth' });
        }
    </script>
</body>
</html>